{% extends "base-site.html" %}

{% block title %} Dashboard {% endblock %} 

{% block content %}

  <div class="my-3 my-md-5">

      <div class="container">

        <div class="row row-cards">
          <div class="col-sm-12 col-lg-8">
            <div class="row">

                <div class="col-lg-12">
                    <div class="card">
                      <div class="card-body d-flex flex-column">
                        <h4><a href="https://twitter.com/search?q=%23xboxseriess&src=typeahead_click"><span class="h3">#XBOXSERIESS</span> {{ nombre }} tweets</a></h4>
                        <div class="text-muted">{{ hashtags }} liste des hashtag #jemlepoulet #troplol #tartiflette #saucisse #onseclate</div>
                      </div>
                    </div>
                </div>
                <div class="col-sm-4 col-lg-4">
                  <div class="card">
                    <div class="card-body text-center">
                      <div class="h5">Réactions positives</div>
                      <div class="display-4 font-weight-bold mb-4">328</div>
                      <div class="progress progress-sm">
                        <div class="progress-bar bg-green" style="width: 33%"></div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-sm-4 col-lg-4">
                    <div class="card">
                    <div class="card-body text-center">
                        <div class="h5">Réactions neutres</div>
                        <div class="display-4 font-weight-bold mb-4">542</div>
                        <div class="progress progress-sm">
                        <div class="progress-bar bg-blue" style="width: 54%"></div>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="col-sm-4 col-lg-4">
                    <div class="card">
                    <div class="card-body text-center">
                        <div class="h5">Réactions négatives</div>
                        <div class="display-4 font-weight-bold mb-4">130</div>
                        <div class="progress progress-sm">
                        <div class="progress-bar bg-red" style="width: 13%"></div>
                        </div>
                    </div>
                    </div>
                </div>
                </div>
            </div>
            <div class="col-sm-12 col-lg-4">
                <div class="row">
                <div class="col-sm-12">
                    <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Récapitulatif</h3>
                    </div>
                    <div class="card-body">
                        <div id="chart-pie" style="height: 20rem;">
							<canvas id="chDonut3"></canvas>
						 </div>
                    </div>
                    </div>
                    </div>
                </div>
            </div>
            

          <div class="col-12" id="top_positive_view">
            <div class="card">
              <div class="card-header bg-green">
                <h3 class="card-title white maj">TOP 5 POSITIF</h3>
              </div>
              <div class="table-responsive">
                <table class="table table-striped table-hover card-table table-vcenter text-nowrap datatable">
                  <thead>
                    <tr>
                      <th class="w-1">No.</th>
                      <th>Date</th>
                      <th>Auteur</th>
                      <th>Langue</th>
                      <th>Status</th>
                      <th>Hashtags associés</th>
                      <th>Message</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="(tweet, rindex) in tweet_list">
                      <td><span class="text-muted">
                        <a :href="'/tweet?id=' + tweet.tweet_id" >{{tweet.tweet_id}}</a>
                        </span></td>
                      <td>
                          {{tweet.created_at.$date| formatDate}}
                      </td>
                      <td style="width: 200px; overflow: hidden; display: inline-block; white-space: nowrap; text-overflow: ellipsis" :title="tweet.user_name">
                        {{tweet.user_name}}
                      </td>
                      <td>
                        {{tweet.language}}
                      </td>
                      <td>
                            <span v-if="tweet.sentiment.sentiment_score == 'negative'" class="status-icon bg-red"></span> {{tweet.sentiment.sentiment_score}}
                            <span v-else-if="tweet.sentiment.sentiment_score == 'positive'" class="status-icon bg-green"></span> {{tweet.sentiment.sentiment_score}}
                            <span v-else-if="tweet.sentiment.sentiment_score == 'neutral'" class="status-icon bg-blue"></span> {{tweet.sentiment.sentiment_score}}
                      </td>
                      <td style="width: 350px; overflow: hidden; display: inline-block; white-space: nowrap; text-overflow: ellipsis">
                        <span v-for="(hashtag, rindex) in tweet.entities.hashtags" style="color: #467fcf; font-weight: bold;">
                            {{'#' + hashtag.text}}
                        </span>
                      </td>
                      <td :title="tweet.text">
                        {{tweet.text}}
                      </td>
                    </tr>
                    </tbody>
                    </table>
                    <!-- <script>
                      require(['datatables', 'jquery'], function(datatable, $) {
                            $('.datatable').DataTable();
                          });
                    </script> -->
                  </div>
            </div>
          </div>

          <div id="top_negative_view" class="col-12">
            <div class="card">
              <div class="card-header bg-red">
                <h3 class="card-title white maj">TOP 5 NEGATIF</h3>
              </div>
              <div class="table-responsive">
                <table class="table table-striped table-hover card-table table-vcenter text-nowrap datatable">
                  <thead>
                    <tr>
                      <th class="w-1">No.</th>
                      <th>Date</th>
                      <th>Auteur</th>
                      <th>Langue</th>
                      <th>Status</th>
                      <th>Hashtags associés</th>
                      <th>Message</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="(tweet, rindex) in tweet_list">
                      <td><span class="text-muted">
                        <a :href="'/tweet?id=' + tweet.tweet_id" >{{tweet.tweet_id}}</a>
                        </span></td>
                      <td>
                          {{tweet.created_at.$date| formatDate}}
                      </td>
                      <td style="width: 200px; overflow: hidden; display: inline-block; white-space: nowrap; text-overflow: ellipsis" :title="tweet.user_name">
                        {{tweet.user_name}}
                      </td>
                      <td>
                        {{tweet.language}}
                      </td>
                      <td>
                            <span v-if="tweet.sentiment.sentiment_score == 'negative'" class="status-icon bg-red"></span> {{tweet.sentiment.sentiment_score}}
                            <span v-else-if="tweet.sentiment.sentiment_score == 'positive'" class="status-icon bg-green"></span> {{tweet.sentiment.sentiment_score}}
                            <span v-else-if="tweet.sentiment.sentiment_score == 'neutral'" class="status-icon bg-blue"></span> {{tweet.sentiment.sentiment_score}}
                      </td>
                      <td style="width: 350px; overflow: hidden; display: inline-block; white-space: nowrap; text-overflow: ellipsis">
                        <span v-for="(hashtag, rindex) in tweet.entities.hashtags" style="color: #467fcf; font-weight: bold;">
                            {{'#' + hashtag.text}}
                        </span>
                      </td>
                      <td :title="tweet.text">
                        {{tweet.text}}
                      </td>
                    </tr>
                    </tbody>
                    </table>
                    <script>
                      require(['datatables', 'jquery'], function(datatable, $) {
                            $('.datatable').DataTable();
                          });
                    </script>
                  </div>
            </div>
          </div>

        </div>

    </div>
  </div>

  <script>
    try{
		/**************   chart pie BEGIN   *******************/
		// chart colors
        var colors = ['#cd201f ','#467fcf','#5eba00'];

        /* 3 donut charts */
        var donutOptions = {
        cutoutPercentage: 50, 
        legend: {position:'bottom', padding:5, labels: {pointStyle:'circle', usePointStyle:true}}
        };

        // donut 3
        var chDonutData3 = {
            labels: ['Negative', 'Neutral', 'Positive'],
            datasets: [
            {
                backgroundColor: colors.slice(0,3),
                borderWidth: 0,
                data: [333, 333, 333]
            }
            ]
        };

        var chDonut3 = document.getElementById("chDonut3");

        if (chDonut3) {
        new Chart(chDonut3, {
            type: 'pie',
            data: chDonutData3,
            options: donutOptions
        });
        }
		
		/**************   chart pie END   *******************/
  
            result_positive = JSON.parse([[positive_tweets| tojson | safe]]);
            result_negative = JSON.parse([[negative_tweets| tojson | safe]]);

            Vue.filter('formatDate', function(value) {
                if (value) {
                    var date = new Date(value);
                    return date.toLocaleString();
                }
            });

            var app = new Vue({
                el:'#top_positive_view',
                data: {
                    tweet_list: result_positive
                }
            });

            var app2 = new Vue({
                el:'#top_negative_view',
                data: {
                    tweet_list: result_negative
                }
            });

            
        } 
        catch (error) {
            alert(error);
        }
</script>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

{% endblock javascripts %}
